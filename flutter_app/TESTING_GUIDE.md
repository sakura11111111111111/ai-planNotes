# Flutter 应用测试指南

本文档提供了 Flutter Android 应用的测试和验证步骤。

## 前置准备

### 1. 确保后端 API 运行正常
```bash
cd ai-planNotes
mvn spring-boot:run
```

验证后端运行：访问 http://localhost:8080，应该看到 Whitelabel Error Page（正常，因为根路径没有映射）

### 2. 检查 Flutter 环境
```bash
cd flutter_app
flutter doctor
```

确保至少有一个 Android 设备/模拟器可用。

## 测试步骤

### 阶段 1：用户认证测试

#### 1.1 注册功能测试
1. 启动应用：`flutter run`
2. 点击"去注册"链接
3. 测试表单验证：
   - [ ] 用户名少于 3 个字符时显示错误
   - [ ] 邮箱格式不正确时显示错误
   - [ ] 密码少于 8 位时显示错误
   - [ ] 密码不包含字母时显示错误
   - [ ] 密码不包含数字时显示错误
   - [ ] 两次密码不一致时显示错误
4. 注册新用户：
   ```
   用户名: testuser001
   邮箱: test001@example.com
   密码: test1234
   确认密码: test1234
   ```
5. 验证：
   - [ ] 注册成功后显示绿色 SnackBar
   - [ ] 自动跳转到登录页面

#### 1.2 登录功能测试
1. 输入注册时的用户名和密码
2. 可选：勾选"记住我"
3. 点击"登录"按钮
4. 验证：
   - [ ] 登录成功后跳转到主页
   - [ ] 显示"今日任务"标题
   - [ ] 底部导航栏有三个选项

#### 1.3 Token 管理测试
1. 输入错误的密码
2. 验证：
   - [ ] 显示红色错误提示
3. 关闭应用后重新打开
4. 验证：
   - [ ] 自动登录（如果勾选了"记住我"）

### 阶段 2：笔记管理测试

#### 2.1 创建分类
1. 点击底部导航栏"分类"
2. 点击右下角 FAB 按钮
3. 输入分类名称："考研数学"
4. 点击"创建"
5. 重复创建以下分类：
   - "英语学习"
   - "编程笔记"
6. 验证：
   - [ ] 分类列表显示所有创建的分类
   - [ ] 每个分类显示在卡片中

#### 2.2 创建笔记（不开启监督）
1. 点击底部导航栏"笔记"
2. 点击右下角 FAB 按钮
3. 输入笔记信息：
   ```
   标题: 微积分基本定理
   内容: 微积分基本定理描述了微分和积分互为逆运算的关系。第一部分说明定积分可以通过不定积分来计算。第二部分说明导数和积分的关系。
   分类: 考研数学
   监督机制: 关闭
   ```
4. 点击"创建"按钮
5. 验证：
   - [ ] 显示"笔记已创建，已加入今日复习计划"提示
   - [ ] 返回笔记列表
   - [ ] 笔记显示在列表顶部

#### 2.3 创建笔记（开启监督）
1. 再次点击 FAB 按钮
2. 输入笔记信息：
   ```
   标题: Python 装饰器
   内容: 装饰器是 Python 中的一个重要特性，用于在不修改原函数代码的情况下，给函数添加新的功能。装饰器本质上是一个高阶函数，它接收一个函数作为参数，并返回一个新的函数。
   分类: 编程笔记
   监督机制: 开启
   监督时长: 15
   ```
3. 点击"创建"
4. 验证：
   - [ ] 创建成功
   - [ ] 笔记卡片显示"监督"标签

#### 2.4 编辑笔记
1. 长按"Python 装饰器"笔记卡片
2. 选择"编辑"
3. 修改标题为："Python 装饰器详解"
4. 修改监督时长为：20
5. 点击"保存"
6. 验证：
   - [ ] 笔记标题已更新
   - [ ] 显示更新成功提示

#### 2.5 查看笔记详情
1. 点击"微积分基本定理"笔记
2. 验证：
   - [ ] 显示完整标题和内容
   - [ ] 显示分类标签
   - [ ] 显示创建和更新时间
   - [ ] 有编辑和删除按钮

### 阶段 3：今日任务测试

#### 3.1 查看今日任务
1. 点击底部导航栏"今日任务"
2. 验证：
   - [ ] 显示刚刚创建的笔记任务
   - [ ] 任务卡片显示标题、分类、复习次数
   - [ ] 开启监督的笔记显示监督标记
   - [ ] 如果有 AI 总结，显示预览

#### 3.2 下拉刷新
1. 下拉任务列表
2. 验证：
   - [ ] 显示刷新动画
   - [ ] 任务列表更新

### 阶段 4：复习功能测试（核心）

#### 4.1 复习无监督笔记
1. 点击"微积分基本定理"的"开始复习"按钮
2. 验证：
   - [ ] 进入复习页面
   - [ ] 显示笔记标题
   - [ ] 显示完整笔记内容
   - [ ] **没有**倒计时显示
   - [ ] 复习结果按钮**立即**可点击（彩色）
3. 展开 AI 总结（如果有）
4. 验证：
   - [ ] AI 总结正确展开/折叠
5. 点击"记住了"按钮
6. 验证：
   - [ ] 显示提交 Loading 状态
   - [ ] 弹出结果对话框
   - [ ] 显示"太棒了！继续保持！"
   - [ ] 显示下次复习日期（绝对日期 + 相对日期）
7. 点击"确定"
8. 验证：
   - [ ] 返回今日任务页面
   - [ ] 该任务从列表中消失

#### 4.2 复习监督笔记（关键测试）
1. 点击"Python 装饰器详解"的"开始复习"按钮
2. 验证倒计时显示：
   - [ ] 页面顶部有**橙色背景**区域
   - [ ] 显示**大字体**倒计时（如"20秒"）
   - [ ] 显示"请认真复习"提示
   - [ ] 显示"倒计时结束后才能提交"说明
3. 验证按钮状态：
   - [ ] "记住了"按钮为**灰色**且不可点击
   - [ ] "有点模糊"按钮为**灰色**且不可点击
   - [ ] "忘记了"按钮为**灰色**且不可点击
4. 等待倒计时（观察每秒递减）：
   - [ ] 倒计时从 20 递减到 0
   - [ ] 每秒更新一次
5. 倒计时结束后验证：
   - [ ] 橙色倒计时区域消失或变化
   - [ ] "记住了"按钮变为**绿色**且可点击
   - [ ] "有点模糊"按钮变为**黄色**且可点击
   - [ ] "忘记了"按钮变为**红色**且可点击
6. 点击"有点模糊"按钮
7. 验证：
   - [ ] 弹出结果对话框
   - [ ] 显示"加油！多复习几次会更好！"
   - [ ] 显示下次复习日期
8. 点击"确定"
9. 验证：
   - [ ] 返回今日任务页面
   - [ ] 任务列表更新

#### 4.3 复习"忘记了"场景
1. 如果还有任务，选择一个点击"开始复习"
2. （如果有监督）等待倒计时结束
3. 点击"忘记了"按钮
4. 验证：
   - [ ] 弹出结果对话框
   - [ ] 显示"没关系，我们再复习一次！"
   - [ ] 显示较近的下次复习日期

### 阶段 5：分类管理测试

#### 5.1 编辑分类
1. 进入"分类"页面
2. 点击"考研数学"的编辑图标
3. 修改名称为："高等数学"
4. 点击"保存"
5. 验证：
   - [ ] 分类名称已更新
   - [ ] 显示更新成功提示

#### 5.2 删除空分类
1. 创建一个新分类："测试分类"
2. 点击删除图标
3. 在确认对话框点击"删除"
4. 验证：
   - [ ] 分类被删除
   - [ ] 显示删除成功提示

#### 5.3 删除有笔记的分类
1. 尝试删除"高等数学"分类
2. 点击删除图标
3. 在确认对话框点击"删除"
4. 验证：
   - [ ] 显示错误提示："该分类下还有笔记，无法删除"
   - [ ] 分类仍然存在

### 阶段 6：笔记删除测试

#### 6.1 从详情页删除
1. 进入"笔记"页面
2. 点击任意笔记进入详情
3. 点击删除图标
4. 在确认对话框点击"删除"
5. 验证：
   - [ ] 返回笔记列表
   - [ ] 笔记已从列表中删除
   - [ ] 显示删除成功提示

#### 6.2 从列表快捷删除
1. 长按笔记卡片
2. 选择"删除"
3. 在确认对话框点击"删除"
4. 验证：
   - [ ] 笔记从列表中删除
   - [ ] 显示删除成功提示

### 阶段 7：空状态测试

#### 7.1 空任务列表
1. 完成所有今日任务
2. 验证：
   - [ ] 显示绿色对号图标
   - [ ] 显示"太棒了！"
   - [ ] 显示"今天没有复习任务"

#### 7.2 空笔记列表
1. 删除所有笔记
2. 进入"笔记"页面
3. 验证：
   - [ ] 显示灰色笔记图标
   - [ ] 显示"还没有笔记"
   - [ ] 显示创建提示

#### 7.3 空分类列表
1. 删除所有分类
2. 进入"分类"页面
3. 验证：
   - [ ] 显示友好的空状态提示

### 阶段 8：错误处理测试

#### 8.1 网络错误
1. 停止后端服务
2. 尝试刷新任务列表
3. 验证：
   - [ ] 显示错误提示："网络连接失败，请检查网络设置"
   - [ ] 有"重试"按钮
4. 重启后端服务
5. 点击"重试"
6. 验证：
   - [ ] 成功加载数据

#### 8.2 表单验证错误
1. 尝试创建笔记但不填写标题
2. 点击"创建"
3. 验证：
   - [ ] 显示"标题不能为空"错误
   - [ ] 无法提交表单

### 阶段 9：用户体验测试

#### 9.1 Loading 状态
验证以下操作都显示 Loading 状态：
- [ ] 登录时
- [ ] 注册时
- [ ] 加载任务列表时
- [ ] 创建笔记时
- [ ] 提交复习结果时

#### 9.2 SnackBar 提示
验证以下操作都显示 SnackBar：
- [ ] 登录成功（绿色）
- [ ] 注册成功（绿色）
- [ ] 创建笔记成功（绿色）
- [ ] 更新笔记成功（绿色）
- [ ] 删除成功（绿色）
- [ ] 操作失败（红色）

#### 9.3 确认对话框
验证以下操作都有确认对话框：
- [ ] 删除笔记
- [ ] 删除分类
- [ ] 退出登录

### 阶段 10：监督机制完整测试（最重要）

#### 10.1 创建不同时长的监督笔记
创建以下笔记测试不同时长：
1. 监督时长 5 秒的笔记
2. 监督时长 30 秒的笔记
3. 监督时长 60 秒的笔记

#### 10.2 验证每个笔记的监督机制
对于每个笔记：
1. 开始复习
2. 验证：
   - [ ] 倒计时显示正确的秒数
   - [ ] 倒计时每秒递减
   - [ ] 倒计时期间按钮禁用
   - [ ] 倒计时结束后按钮可用
3. 尝试在倒计时期间点击按钮
4. 验证：
   - [ ] 按钮无响应（真正禁用）

#### 10.3 边界情况测试
1. 创建监督时长 1 秒的笔记
2. 验证：
   - [ ] 倒计时正常工作
   - [ ] 1 秒后按钮可用

### 阶段 11：退出登录测试

1. 点击右上角菜单
2. 选择"退出登录"
3. 在确认对话框点击"确定"
4. 验证：
   - [ ] 返回登录页面
   - [ ] Token 已清除
5. 重新打开应用
6. 验证：
   - [ ] 显示登录页面（未自动登录）

## 性能测试

### 1. 列表滚动性能
1. 创建 20+ 条笔记
2. 快速滚动笔记列表
3. 验证：
   - [ ] 滚动流畅，无卡顿

### 2. 下拉刷新性能
1. 多次快速下拉刷新
2. 验证：
   - [ ] 响应及时
   - [ ] 无崩溃

### 3. 复习页面性能
1. 查看包含大量文本的笔记
2. 验证：
   - [ ] 页面滚动流畅
   - [ ] 倒计时准确

## UI/UX 检查清单

### 整体风格
- [ ] 界面简洁清爽
- [ ] 色彩搭配合理
- [ ] 字体大小适中
- [ ] 间距合理

### 色彩语义
- [ ] 绿色用于成功/记住
- [ ] 黄色/橙色用于警告/模糊
- [ ] 红色用于错误/忘记
- [ ] 蓝色用于主要操作

### 监督机制 UI
- [ ] 倒计时区域醒目（橙色背景）
- [ ] 倒计时数字够大（48px）
- [ ] 禁用状态明显（灰色）
- [ ] 可用状态明显（彩色）
- [ ] 提示文字清晰

### 卡片设计
- [ ] 任务卡片信息完整
- [ ] 笔记卡片布局合理
- [ ] 分类卡片清晰
- [ ] 阴影效果适中

### 图标使用
- [ ] 图标含义清晰
- [ ] 图标大小合适
- [ ] 图标颜色协调

## 测试报告模板

```
测试日期：____年____月____日
测试人员：____________
设备信息：____________
Android 版本：____________

测试结果统计：
- 总测试项：____
- 通过项：____
- 失败项：____
- 通过率：____%

主要问题：
1. 
2. 
3. 

建议改进：
1. 
2. 
3. 

总体评价：
□ 优秀  □ 良好  □ 一般  □ 需改进
```

## 常见问题排查

### 1. 无法连接后端
- 检查后端是否运行：`curl http://localhost:8080`
- Android 模拟器使用 `10.0.2.2` 而不是 `localhost`
- 真机使用电脑的局域网 IP
- 检查 `AndroidManifest.xml` 的 `usesCleartextTraffic` 设置

### 2. Token 过期
- 后端默认 Token 有效期为 24 小时
- 超时后会自动跳转登录页
- 重新登录即可

### 3. 倒计时不准确
- 检查设备时间是否正确
- 检查是否有其他应用占用 CPU

### 4. 列表不刷新
- 检查 Provider 的 `notifyListeners()` 是否调用
- 检查网络请求是否成功

## 测试完成标准

所有测试项都应该通过（打勾✓）才算测试完成。特别注意：

1. **监督机制**必须完全符合要求
2. **所有 CRUD 操作**必须正常工作
3. **错误处理**必须友好清晰
4. **UI/UX** 必须符合设计要求

如果发现任何问题，请记录详细信息并报告。
